<body>
    <script>
        (function() {
            if (window.__hlxNotifierWS && window.__hlxNotifierWS.readyState === WebSocket.OPEN) {
                console.log("WebSocket is already open. Skipping new connection.");
                return;
            }
        
            const channel = "$1225051102$";
            const ws = new WebSocket("ws://localhost:3083/ws/" + channel);
            window.__hlxNotifierWS = ws; // Store the reference globally
        
            console.log("Connecting to channel:", channel);
        
            ws.onopen = function() {
                console.log("WebSocket connected to channel:", channel);
            };
        
            ws.onmessage = function (event) {
                console.log("Push notification received:", event.data);
                try {
                    const data = JSON.parse(event.data);
                    const eventName = channel;
                    const requestId = data.message;  // The message sent via REST POST

                    if (parent && parent.DView && typeof parent.DView.SendSignalToParent === "function") {
                        console.log("Sending signal to AR Server: event =", eventName, " requestId =", requestId);
                        parent.DView.SendSignalToParent(undefined, eventName, requestId);
                    } else {
                        console.warn("Unable to send signal â€“ parent.DView.SendSignalToParent is missing");
                    }

                } catch (e) {
                    console.error("Error handling push data:", e);
                }
            };
        
            ws.onerror = function(error) {
                console.error("WebSocket error:", error);
            };
        
            ws.onclose = function(event) {
                console.warn("WebSocket disconnected. Code:", event.code, "Reason:", event.reason);
                window.__hlxNotifierWS = null;
            };
        })();
    </script>
</body>
